[workspace]
authors = ["Min RK <benjaminrk@gmail.com>"]
channels = ["conda-forge/label/jupyter-ai_rc", "conda-forge"]
name = "fernando-hub"
platforms = ["osx-arm64"]
version = "0.1.0"

[activation.env]
# clone this repo into /opt/jupyterhub
PIXI_HOME = "/opt/jupyterhub/"

[tasks]
update-daemons = "sudo cp -v LaunchDaemons/*.plist /Library/LaunchDaemons/"
reload-daemons = { cmd = "bash -c 'for f in /Library/LaunchDaemons/org.jupyter.hub.*.plist; do echo reloading $f; sudo launchctl unload $f; sudo launchctl load $f; done'", depends-on = [
  "update-daemons",
] }
restart-daemons = "sh -c 'for name in $(sudo launchctl list | grep org.jupyter.hub | cut -f 3); do echo restarting $name; sudo launchctl kickstart -k $name; done'"
setup-logs = "sudo mkdir -p /Library/Logs/jupyterhub/traefik; sudo chown -R _traefik:admin /Library/Logs/jupyterhub/traefik"
permissions = "sudo chown -R root:admin /opt/jupyterhub; sudo chmod -R a+rX /opt/jupyterhub/.pixi/envs; sudo chmod -R g+rw /opt/jupyterhub/; sudo chown -R root:admin /Library/Logs/jupyterhub; sudo chmod g+rX /Library/Logs/jupyterhub"


[dependencies]

# shared dependencies across hub and user
# not 'default' because we might have tasks
[feature.common.dependencies]
python = "3.12.*"
jupyterhub-base = "5.4.*"

# Hub environment
[feature.hub.dependencies]
jupyterhub-traefik-proxy = "*"

# User environment
[feature.user.dependencies]
jupyterlab = "*"
jupyter-ai = ">=3.0.0b7"
ipywidgets = "*"
altair = "*"
jupyter-collaboration = "*"
ruff = "*"
jupyterlab_code_formatter = "*"
pre-commit = "*"
matplotlib-base = "*"
scipy = "*"
uv = "*"


[environments]
user = ["user", "common"]
hub = ["hub", "common"]
